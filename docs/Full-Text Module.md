
# Full-Text Module
 


 
This [XQuery Module](Module Library.md) extends the [W3C Full Text Recommendation](http://www.w3.org/TR/xpath-full-text-10) with some useful functions: The index can be directly accessed, full-text results can be marked with additional elements, or the relevant parts can be extracted. Moreover, the score value, which is generated by the `contains text` expression, can be explicitly requested from items. 

 
## Conventions

All functions in this module are assigned to the `http://basex.org/modules/ft` namespace, which is statically bound to the `ft` prefix. All errors are assigned to the `http://basex.org/errors` namespace, which is statically bound to the `bxerr` prefix. 

 
## Functions

### ft:search

`ft:search($db as xs:string, $terms as item()*) as text()*`
`ft:search($db as xs:string, $terms as item()*, $options as item()) as text()*`

Returns all text nodes from the full-text index of the database `$db` that contain the specified `$terms`.The options used for tokenizing the input and building the full-text will also be applied to the search terms. As an example, if the index terms have been stemmed, the search string will be stemmed as well.  The `$options` argument can be used to control full-text processing. Options can be either specified The following options are supported (the introduction on [Full-Text](Full-Text.md) processing gives you equivalent expressions in the XQuery Full-Text notation): 

**Errors**

`BXDB0002`: The addressed database does not exist or could not be opened.`BXDB0004`: the full-text index is not available.`BXFT0001`: the fuzzy and wildcard option cannot be both specified. 
**Examples**

 * `ft:search("DB", "QUERY")` : Return all text nodes of the database `DB` that contain the term `QUERY`. 
 * Return all text nodes of the database `DB` that contain the numbers `2010` and `2011`:`ft:search("DB", ("2010","2011"), map { 'mode': 'all' })`
 * Return text nodes that contain the terms `A` and `B` in a distance of at most 5 words: 

    ft:search("db", ("A", "B"), map {
      "mode": "all words",
      "distance": {
        "max": "5",
        "unit": "words"
      }
    })

 * Iterate over three databases and return all elements containing terms similar to `Hello World` in the text nodes: 

    let $terms := "Hello Worlds"
    let $fuzzy := true()
    let $options := <options><fuzzy value="{ $fuzzy }"/></options>
    for $db in 1 to 3
    let $dbname := 'DB' || $db
    return ft:search($dbname, $terms, $options)/..



### ft:contains

`ft:contains($input as item()*, $terms as item()*) as xs:boolean`
`ft:contains($input as item()*, $terms as item()*, $options as item()) as xs:boolean`

Checks if the specified `$input` items contain the specified `$terms`.The function does the same as the [Full-Text](Full-Text.md) expression `contains text`, but options can be specified more dynamically. The `$options` are the same as for [ft:search](Full-Text Module.md#ft-search), and the following ones in addition:  * `case` : determines how character case is processed. Allowed values are `insensitive`, `sensitive`, `upper` and `lower`. By default, search is case insensitive. 
 * `diacritics` : determines how diacritical characters are processed. Allowed values are `insensitive` and `sensitive`. By default, search is diacritical insensitive. 
 * `stemming` : determines is tokens are stemmed. Allowed values are `true` and `false`. By default, stemming is turned off. 
 * `language` : determines the language. This option is relevant for stemming tokens. All language codes are supported. The default language is `en`. 


**Errors**

`BXFT0001`: the fuzzy and wildcard option cannot be both specified. 
**Examples**

 * Checks if `jack` or `john` occurs in the input string `John Doe`: 

    ft:contains("John Doe", ("jack", "john"), map { "mode": "any" })

 * Calls the function with stemming turned on and off: 

    (true(), false()) ! ft:contains("Häuser", "Haus", map { 'stemming': ., 'language':'de' })



### ft:mark

`ft:mark($nodes as node()*) as node()*`
`ft:mark($nodes as node()*, $name as xs:string) as node()*`

Puts a marker element around the resulting `$nodes` of a full-text index request.The default name of the marker element is `mark`. An alternative name can be chosen via the optional `$name` argument.Please note that:  * the full-text expression that computes the token positions must be specified as argument of the `ft:mark()` function, as all position information is lost in subsequent processing steps. You may need to specify more than one full-text expression if you want to use the function in a FLWOR expression, as shown in Example 2. 
 * the XML node to be transformed must be an internal "database" node. The `transform` expression can be used to apply the method to a main-memory fragment, as shown in Example 3. 


**Examples**

**Example 1**: The following query returns `<XML><mark>hello</mark> world</XML>`, if one text node of the database `DB` has the value "hello world": 
    ft:mark(db:open('DB')//*[text() contains text 'hello'])

**Example 2**: The following expression loops through the first ten full-text results and marks the results in a second expression: **Example 3**: The following expression returns `<p><b>word</b></p>`: 

### ft:extract

`ft:extract($nodes as node()*) as node()*`
`ft:extract($nodes as node()*, $name as xs:string) as node()*`
`ft:extract($nodes as node()*, $name as xs:string, $length as xs:integer) as node()*`

Extracts and returns relevant parts of full-text results. It puts a marker element around the resulting `$nodes` of a full-text index request and chops irrelevant sections of the result.The default tag name of the marker element is `mark`. An alternative tag name can be chosen via the optional `$name` argument.The default length of the returned text is `150` characters. An alternative length can be specified via the optional `$length` argument. Note that the effective text length may differ from the specified text due to formatting and readibility issues.For more details on this function, please have a look at [ft:mark](Full-Text Module.md#ft-mark). 

**Examples**

 * The following query may return `<XML>...<b>hello</b>...<XML>` if a text node of the database `DB` contains the string "hello world": 

    ft:extract(db:open('DB')//*[text() contains text 'hello'], 'b', 1)



### ft:count

`ft:count($nodes as node()*) as xs:integer`

Returns the number of occurrences of the search terms specified in a full-text expression. 

**Examples**

 * `ft:count(//*[text() contains text 'QUERY'])`  returns the `xs:integer` value `2` if a document contains two occurrences of the string "QUERY". 


### ft:score

`ft:score($item as item()*) as xs:double*`

Returns the score values (0.0 - 1.0) that have been attached to the specified items. `0` is returned a value if no score was attached. 

**Examples**

 * `ft:score('a' contains text 'a')`  returns the `xs:double` value `1`. 


### ft:tokens

`ft:tokens($db as xs:string) as element(value)*`
`ft:tokens($db as xs:string, $prefix as xs:string) as element(value)*`

Returns all full-text tokens stored in the index of the database `$db`, along with their numbers of occurrences.If `$prefix` is specified, the returned nodes will be refined to the strings starting with that prefix. The prefix will be tokenized according to the full-text used for creating the index. 

**Errors**

`BXDB0002`: The addressed database does not exist or could not be opened.`BXDB0004`: the full-text index is not available. 
**Examples**

Finds the number of occurrences for a single, specific index entry (the positional predicate speeds up retrieval): 
    let $term := ft:tokenize($term)
    return data((ft:tokens('db', $term)[. = $term])[1]/@count)



### ft:tokenize

`ft:tokenize($input as xs:string) as xs:string*`
`ft:tokenize($input as xs:string, $options as item()) as xs:string*`

Tokenizes the given `$input` string, using the current default full-text options or the `$options` specified as second argument. The following options are available:  * `case` : determines how character case is processed. Allowed values are `insensitive`, `sensitive`, `upper` and `lower`. By default, search is case insensitive. 
 * `diacritics` : determines how diacritical characters are processed. Allowed values are `insensitive` and `sensitive`. By default, search is diacritical insensitive. 
 * `stemming` : determines is tokens are stemmed. Allowed values are `true` and `false`. By default, stemming is turned off. 
 * `language` : determines the language. This option is relevant for stemming tokens. All language codes are supported. The default language is `en`. 

 The `$options` argument can be used to control full-text processing. Options can be either specified 

**Examples**

 * `ft:tokenize("No Doubt")`  returns the two strings `no` and `doubt`. 
 * `ft:tokenize("École", map { 'diacritics': 'sensitive' })`  returns the string `école`. 
 * `declare ft-option using stemming; ft:tokenize("GIFTS")`  returns a single string `gift`. 


### ft:normalize

`ft:normalize($input as xs:string) as xs:string*`
`ft:normalize($input as xs:string, $options as item()) as xs:string*`

Normalizes the given `$input` string, using the current default full-text options or the `$options` specified as second argument. The function provides the same arguments as [ft:tokenize](Full-Text Module.md#ft-tokenize). 

**Examples**

 * `ft:tokenize("Häuser am Meer", map { 'case': 'sensitive' })`  returns the string `Hauser am Meer`. 

 
## Errors

**Code ** | Description 
--------- | ------------
`BXFT0001` | Both wildcards and fuzzy search have been specified as search options. 
 
## Changelog
UNKNOWN * Added: [ft:contains](Full-Text Module.md#ft-contains), [ft:normalize](Full-Text Module.md#ft-normalize)
 * Updated: Options added to [ft:tokenize](Full-Text Module.md#ft-tokenize)
UNKNOWN * Added: [ft:contains](Full-Text Module.md#ft-contains)
 * Updated: Options added to [ft:search](Full-Text Module.md#ft-search)
UNKNOWN * Updated: the functions no longer accept [Database Nodes](Database Module.md#Database_Nodes) as reference. Instead, the name of a database must now be specified. 
UNKNOWN * Updated: [ft:search](Full-Text Module.md#ft-search) (second argument generalized, third parameter added) 
UNKNOWN * Added: [ft:tokens](Full-Text Module.md#ft-tokens), [ft:tokenize](Full-Text Module.md#ft-tokenize)
